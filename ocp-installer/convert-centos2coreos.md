## Covert an existing Centos8 to Coreos

The solution is meaningful for ocp installation automatic
1. Download kernel, initramfs and rootfs files of coreos
2. Put rootfs and ignition files to a http server
3. Copy kernek and initramfs to /boot of centos8
4. Update `/boot/grub2/grub.cfg` or `/boot/efi/EFI/centos/grub.cfg`    

Do not change the file directly, the file is generated by `grub2-mkconfig`

* Update the `/etc/grub.d/40_custom` to add new entry when os startup
```
menuentry 'coreos' {
        set root='hd0,gtp2'
        linux /rhcos-live-kernel-x86_64 coreos.inst=yes coreos.inst.install_dev=sda rd.neednet=1 console=tty0 console=ttyS0 coreos.live.rootfs_url=http:/172.16.251.44:9080/ocp4-workspace/dependencies/rhcos-live-rootfs.x86_64.img coreos.inst.ignition_url=http:/172.16.251.44:9080/ocp4-workspace/dependencies/worker.ign ip=172.16.253.108::172.16.255.250:255.255.255.0:worker-4.ocp48.cluster.local.com:ens192:none nameserver=172.16.251.44
        initrd /rhcos-live-initramfs.x86_64.img
}

```
For the upper command:   
`coreos.inst.install_dev=sda`, "sda" is the name of HD.   
`set root='hd0,gtp2'` is the HD and partition of `/boot`, the value means the first HD and the 2nd partition. `gtp` is the type of partition.
* Run command to generate configuration:
`grub2-mkconfig -o /boot/grub2/grub.cfg` and
`grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg`

* Update `/etc/default/grub` to change `GRUB_DEFAULT=saved` to `GRUB_DEFAULT=coreos`

* reboot
   

## Reference:
1. [Understand linux boot](https://koktlzz.github.io/posts/understand-linux-boot-process-by-installing-coreos/)
2. [Setup grub2 with Centos7](https://wiki.centos.org/zh/HowTos/Grub2)

